<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presupuesto PRO</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <style>
        :root { --primary: #2c3e50; --secondary: #27ae60; --danger: #e74c3c; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: var(--bg); color: #333; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: var(--primary); text-align: center; border-bottom: 3px solid var(--primary); padding-bottom: 10px; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; background: #eceff1; padding: 15px; border-radius: 8px; }
        .info-item b { display: block; color: var(--primary); font-size: 0.9em; }
        [contenteditable] { background: white; padding: 5px; border: 1px solid #ddd; border-radius: 4px; min-height: 1.2em; display: inline-block; width: 90%; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: var(--primary); color: white; padding: 12px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #eee; }
        
        .total-section { margin-top: 20px; text-align: right; font-size: 1.1em; border-top: 2px solid var(--primary); padding-top: 10px; }
        .total-final { font-size: 1.5em; font-weight: bold; color: var(--secondary); }

        .actions { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; min-width: 140px; }
        .btn-add { background: var(--primary); }
        .btn-print { background: var(--secondary); }
        .btn-clear { background: var(--danger); }
        button:hover { opacity: 0.8; }

        @media print { .actions, .btn-remove { display: none !important; } .container { box-shadow: none; width: 100%; } [contenteditable] { border: none; } }
    </style>
</head>
<body>

<div class="container">
    <h1>PRESUPUESTO</h1>

    <div class="info-grid">
        <div class="info-item"><b>EMPRESA:</b> <span contenteditable="true">Nombre Empresa</span></div>
        <div class="info-item"><b>CLIENTE:</b> <span contenteditable="true">Nombre Cliente</span></div>
        <div class="info-item"><b>Nº PRESUPUESTO:</b> <span contenteditable="true">001</span></div>
        <div class="info-item"><b>FECHA:</b> <span id="fechaActual"></span></div>
    </div>

    <table id="tabla">
        <thead>
            <tr>
                <th style="width: 50%;">Descripción</th>
                <th>Cant.</th>
                <th>Precio (€)</th>
                <th>Total</th>
                <th class="btn-remove"></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td contenteditable="true">Mano de obra / Materiales</td>
                <td contenteditable="true" class="qty" oninput="calcular()">1</td>
                <td contenteditable="true" class="price" oninput="calcular()">0</td>
                <td class="row-total">0.00 €</td>
                <td class="btn-remove"></td>
            </tr>
        </tbody>
    </table>

    <div class="actions">
        <button class="btn-add" onclick="agregarFila()">+ Añadir Línea</button>
        <button class="btn-clear" onclick="limpiarTodo()">Limpiar</button>
        <button class="btn-print" onclick="window.print()">Guardar PDF / Enviar</button>
    </div>

    <div class="total-section">
        <div>Subtotal: <span id="subtotal">0.00</span> €</div>
        <div>IVA (21%): <span id="iva">0.00</span> €</div>
        <div class="total-final">TOTAL: <span id="totalFinal">0.00</span> €</div>
    </div>
</div>

<script>
    document.getElementById('fechaActual').innerText = new Date().toLocaleDateString();

    function agregarFila() {
        const tbody = document.querySelector('#tabla tbody');
        const nuevaFila = document.createElement('tr');
        nuevaFila.innerHTML = `
            <td contenteditable="true">Nuevo concepto</td>
            <td contenteditable="true" class="qty" oninput="calcular()">1</td>
            <td contenteditable="true" class="price" oninput="calcular()">0</td>
            <td class="row-total">0.00 €</td>
            <td class="btn-remove"><button onclick="this.parentElement.parentElement.remove(); calcular()" style="background:none; color:red; padding:0; min-width:auto;">✕</button></td>
        `;
        tbody.appendChild(nuevaFila);
        calcular();
    }

    function calcular() {
        let subtotal = 0;
        document.querySelectorAll('#tabla tbody tr').forEach(row => {
            const qty = parseFloat(row.querySelector('.qty').innerText) || 0;
            const price = parseFloat(row.querySelector('.price').innerText) || 0;
            const total = qty * price;
            row.querySelector('.row-total').innerText = total.toFixed(2) + ' €';
            subtotal += total;
        });
        const iva = subtotal * 0.21;
        document.getElementById('subtotal').innerText = subtotal.toFixed(2);
        document.getElementById('iva').innerText = iva.toFixed(2);
        document.getElementById('totalFinal').innerText = (subtotal + iva).toFixed(2);
    }

    function limpiarTodo() {
        if(confirm("¿Seguro que quieres borrar todo el presupuesto?")) {
            location.reload();
        }
    }

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('sw.js'); });
    }
</script>

</body>
</html>